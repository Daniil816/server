import os
import pickle
import vk_api
import time
import gspread
import json
import random
from datetime import datetime, timedelta
from vk_api.longpoll import VkLongPoll, VkEventType
from google.auth.transport.requests import Request
from google_auth_oauthlib.flow import InstalledAppFlow

# --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
VK_TOKEN = 'vk1.a.hnuRWe9zj3RAiXc-2Jhi3ix1wDAYPeA3vv5EuURXKIptRpDR8G948Q891ndVNMuOnz69LxbvAbXQVACkIlLuhQidngypMtSGg4Sv6keay8XH-0WZOs9_L9m4LmXcV3F8pg3dyOTiujoSmzTqi9j2g5j_txPUcKILy_kbavL40GLZ_qLhzbuQjBI_PokDT1cExggdvo2CSgUOsdZBkFayLQ'
SPREADSHEET_NAME = '29 | –†–∞–±–æ—Ç–∞'
RIGHTS_FILE = 'user_rights.json'
# –°–£–ü–ï–†–ê–î–ú–ò–ù–´ - –Ω–µ–ª—å–∑—è –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞
SUPER_ADMINS = [807253464, 679050151]
SCOPES = ['https://www.googleapis.com/auth/spreadsheets']
user_rights = {}

# –¶–≤–µ—Ç–∞ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π
COLOR_MAP = {
    1: {
        'B_bg': {'red': 0.741, 'green': 0.902, 'blue': 0.988},  # —Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π (2)
        'B_text': {'red': 0.0, 'green': 0.0, 'blue': 1.0},  # —Å–∏–Ω–∏–π
        'D_bg': {'red': 0.741, 'green': 0.902, 'blue': 0.988},  # —Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π (2)
    },
    2: {
        'B_bg': {'red': 0.956, 'green': 0.8, 'blue': 0.8},  # —Å–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π (2)
        'B_text': {'red': 1.0, 'green': 0.0, 'blue': 0.0},  # –∫—Ä–∞—Å–Ω—ã–π
        'D_bg': {'red': 0.741, 'green': 0.902, 'blue': 0.988},  # —Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π (2)
    },
    3: {
        'B_bg': {'red': 0.819, 'green': 0.756, 'blue': 0.933},  # —Å–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (2)
        'B_text': {'red': 1.0, 'green': 0.0, 'blue': 0.0},  # –∫—Ä–∞—Å–Ω—ã–π
        'D_bg': {'red': 0.819, 'green': 0.756, 'blue': 0.933},  # —Å–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (2)
    },
    4: {
        'B_bg': {'red': 0.694, 'green': 0.627, 'blue': 0.870},  # —Ç–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (1)
        'B_text': {'red': 0.576, 'green': 0.117, 'blue': 0.117},  # —Å–≤–µ—Ç–ª–æ-–±–æ—Ä–¥–æ–≤—ã–π (1)
        'D_bg': {'red': 0.772, 'green': 0.690, 'blue': 0.901},  # —Å–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (1)
    },
    5: {
        'B_bg': {'red': 0.968, 'green': 0.658, 'blue': 0.658},  # —Å–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π (3)
        'B_text': {'red': 0.576, 'green': 0.117, 'blue': 0.117},  # —Å–≤–µ—Ç–ª–æ-–±–æ—Ä–¥–æ–≤—ã–π (1)
        'D_bg': {'red': 0.917, 'green': 0.6, 'blue': 0.6},  # —Å–≤–µ—Ç–ª–æ-–±–æ—Ä–¥–æ–≤—ã–π (2)
    }
}

def add_single_row_to_sheet(sheet):
    """–î–æ–±–∞–≤–ª—è–µ—Ç –æ–¥–Ω—É –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω–µ—Ü —Ç–∞–±–ª–∏—Ü—ã"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã
        sheet_info = sheet.spreadsheet.fetch_sheet_metadata()
        grid_props = sheet_info['sheets'][0]['properties']['gridProperties']
        current_rows = grid_props.get('rowCount', 0)

        # –î–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
        sheet.spreadsheet.batch_update({
            'requests': [{
                'appendDimension': {
                    'sheetId': sheet.id,
                    'dimension': 'ROWS',
                    'length': 1
                }
            }]
        })
        print(f"‚úì –î–æ–±–∞–≤–ª–µ–Ω–∞ 1 —Å—Ç—Ä–æ–∫–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ (–±—ã–ª–æ: {current_rows}, —Å—Ç–∞–ª–æ: {current_rows + 1})")
        return True
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏: {e}")
        return False

def ensure_sheet_has_row(sheet, row_number):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å—Ç—Ä–æ–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ, –µ—Å–ª–∏ –Ω–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ—Ç"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã
        sheet_info = sheet.spreadsheet.fetch_sheet_metadata()
        grid_props = sheet_info['sheets'][0]['properties']['gridProperties']
        max_rows = grid_props.get('rowCount', 0)

        # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
        if row_number > max_rows:
            rows_to_add = row_number - max_rows
            print(f"‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {row_number} –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —Ç–∞–±–ª–∏—Ü—ã ({max_rows} —Å—Ç—Ä–æ–∫). –î–æ–±–∞–≤–ª—è–µ–º {rows_to_add} —Å—Ç—Ä–æ–∫...")

            # –ò—Å–ø–æ–ª—å–∑—É–µ–º batch_update –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫
            sheet.spreadsheet.batch_update({
                'requests': [{
                    'appendDimension': {
                        'sheetId': sheet.id,
                        'dimension': 'ROWS',
                        'length': rows_to_add
                    }
                }]
            })
            print(f"‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ {rows_to_add} —Å—Ç—Ä–æ–∫ (—Ç–µ–ø–µ—Ä—å {max_rows + rows_to_add} —Å—Ç—Ä–æ–∫)")
            return True
        return True
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç—Ä–æ–∫–∏: {e}")
        return False

def load_user_rights():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ñ–∞–π–ª–∞"""
    global user_rights
    if os.path.exists(RIGHTS_FILE):
        try:
            with open(RIGHTS_FILE, 'r', encoding='utf-8') as f:
                user_rights = json.load(f)
            user_rights = {int(k): v for k, v in user_rights.items()}
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∞–≤: {e}")
            user_rights = {}
    else:
        user_rights = {}

    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–æ–≤, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ —Ñ–∞–π–ª–µ
    for super_admin_id in SUPER_ADMINS:
        if super_admin_id not in user_rights:
            user_rights[super_admin_id] = {
                'role': 'super_admin',
                'permissions': ['add_admin', 'add_editor', 'edit_table', 'grant_access', 'revoke_super', 'lvlup'],
                'is_super': True,
                'added_by': 'system',
                'added_date': time.strftime("%d.%m.%Y %H:%M:%S")
            }
        else:
            # –ï—Å–ª–∏ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω —É–∂–µ –µ—Å—Ç—å –≤ —Ñ–∞–π–ª–µ, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø—Ä–∞–≤–∞
            user_info = user_rights[super_admin_id]
            if 'permissions' not in user_info:
                user_info['permissions'] = []
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            required_permissions = ['add_admin', 'add_editor', 'edit_table', 'grant_access', 'revoke_super', 'lvlup']
            for perm in required_permissions:
                if perm not in user_info['permissions']:
                    user_info['permissions'].append(perm)
                    print(f"‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–æ '{perm}' —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω—É {super_admin_id}")
    
    save_user_rights()

def save_user_rights():
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ñ–∞–π–ª"""
    try:
        with open(RIGHTS_FILE, 'w', encoding='utf-8') as f:
            json.dump(user_rights, f, ensure_ascii=False, indent=2)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤: {e}")

def get_user_role(user_id):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if user_id in user_rights:
        return user_rights[user_id].get('role', 'user')
    return 'user'

def is_super_admin(user_id):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–æ–º"""
    return user_id in SUPER_ADMINS

def has_permission(user_id, permission):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ"""
    # –°—É–ø–µ—Ä–∞–¥–º–∏–Ω—ã –∏–º–µ—é—Ç –≤—Å–µ –ø—Ä–∞–≤–∞
    if is_super_admin(user_id):
        return True
    
    if user_id in user_rights:
        user_info = user_rights[user_id]
        
        # –î–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –∏ –≤—ã—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–∞–µ–º –ø—Ä–∞–≤–æ lvlup
        if permission == 'lvlup':
            role = user_info.get('role', 'user')
            if role in ['editor', 'admin', 'super_admin']:
                return True
        
        permissions = user_info.get('permissions', [])
        return permission in permissions
    
    return False

def can_revoke_rights(revoker_id, target_id):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞ —É –¥—Ä—É–≥–æ–≥–æ"""
    if is_super_admin(revoker_id):
        return not is_super_admin(target_id)
    if has_permission(revoker_id, 'grant_access'):
        return not (is_super_admin(target_id) or has_permission(target_id, 'grant_access'))
    return False

def add_user_rights(user_id, role, permissions, added_by):
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if is_super_admin(user_id):
        return False, "–ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∞ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∞!"

    user_rights[user_id] = {
        'role': role,
        'permissions': permissions,
        'added_by': added_by,
        'added_date': time.strftime("%d.%m.%Y %H:%M:%S"),
        'is_super': False
    }
    save_user_rights()
    return True, "–ü—Ä–∞–≤–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã"

def remove_user_rights(user_id, remover_id):
    """–£–¥–∞–ª—è–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if not can_revoke_rights(remover_id, user_id):
        return False, "–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –æ—Ç–∑—ã–≤–∞ –ø—Ä–∞–≤ —É —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!"

    if user_id in user_rights:
        if user_rights[user_id].get('is_super', False):
            return False, "–ù–µ–ª—å–∑—è —É–¥–∞–ª—è—Ç—å —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∞!"

        role = user_rights[user_id].get('role', 'user')
        del user_rights[user_id]
        save_user_rights()
        return True, f"–ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} ({role}) —É—Å–ø–µ—à–Ω–æ –æ—Ç–æ–∑–≤–∞–Ω—ã!"
    return False, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"

def get_google_client():
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ Google Sheets"""
    creds = None
    if os.path.exists('token.pickle'):
        with open('token.pickle', 'rb') as token:
            creds = pickle.load(token)

    if not creds or not creds.valid:
        if creds and creds.expired and creds.refresh_token:
            creds.refresh(Request())
        else:
            flow = InstalledAppFlow.from_client_secrets_file('client_secret.json', SCOPES)
            print("–ù—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤ –±—Ä–∞—É–∑–µ—Ä–µ...")
            creds = flow.run_local_server(port=8080)

        with open('token.pickle', 'wb') as token:
            pickle.dump(creds, token)

    return gspread.authorize(creds)

def get_last_non_empty_row(sheet):
    """–ù–∞—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ"""
    try:
        all_values = sheet.get_all_values()
        # –ò—â–µ–º —Å –∫–æ–Ω—Ü–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏ (–∏–≥–Ω–æ—Ä–∏—Ä—É—è –∑–∞–≥–æ–ª–æ–≤–æ–∫)
        for i in range(len(all_values) - 1, 0, -1):
            row = all_values[i]
            if any(cell.strip() for cell in row):
                return i + 1  # +1 –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ gspread —Å—Ç—Ä–æ–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 1
        # –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        return 1
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏: {e}")
        # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ + 1
        return len(sheet.get_all_values()) + 1

def find_empty_row(sheet, start_row=None):
    """–ù–∞—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—É—é –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É, –Ω–∞—á–∏–Ω–∞—è —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –∏–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –Ω–µ–ø—É—Å—Ç–æ–π"""
    try:
        if start_row is None:
            start_row = get_last_non_empty_row(sheet)

        all_values = sheet.get_all_values()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—è —Å start_row
        for row_num in range(start_row, len(all_values) + 1):
            # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ all_values, –∑–Ω–∞—á–∏—Ç –æ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç–∞—è
            if row_num > len(all_values):
                return row_num

            # –ü–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–æ–∫—É (–∏–Ω–¥–µ–∫—Å row_num-1)
            row_index = row_num - 1
            if row_index < len(all_values):
                row = all_values[row_index]
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—É—Å—Ç–∞—è –ª–∏ —Å—Ç—Ä–æ–∫–∞
                if not any(cell.strip() for cell in row):
                    return row_num

        # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π
        return len(all_values) + 1

    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏: {e}")
        return get_last_non_empty_row(sheet) + 1

def apply_complete_row_formatting(sheet, row_number, make_bold=False):
    """–ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏: —Ü–≤–µ—Ç–∞, —à—Ä–∏—Ñ—Ç, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ"""
    try:
        requests = []
        
        # –¶–≤–µ—Ç–∞ —Ñ–æ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ç–æ–ª–±—Ü–æ–≤
        column_colors = {
            1: {'red': 0.415, 'green': 0.658, 'blue': 0.309},  # #6aa84f
            2: {'red': 0.741, 'green': 0.902, 'blue': 0.988},  # —Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π (2)
            3: {'red': 1.0, 'green': 1.0, 'blue': 1.0},  # –±–µ–ª—ã–π
            4: {'red': 0.741, 'green': 0.902, 'blue': 0.988},  # —Å–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π (2)
            5: {'red': 1.0, 'green': 1.0, 'blue': 1.0},  # –±–µ–ª—ã–π (–°–¢–û–õ–ë–ï–¶ E)
            6: {'red': 1.0, 'green': 1.0, 'blue': 1.0},  # –±–µ–ª—ã–π (–°–¢–û–õ–ë–ï–¶ F)
            7: {'red': 0.725, 'green': 0.878, 'blue': 0.976},  # —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π (2)
            8: {'red': 0.631, 'green': 0.808, 'blue': 0.957},  # —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π (1)
            9: {'red': 0.819, 'green': 0.756, 'blue': 0.933},  # —Å–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (2)
            10: {'red': 1.0, 'green': 0.898, 'blue': 0.6},  # #ffe599
            11: {'red': 0.956, 'green': 0.8, 'blue': 0.8},  # —Å–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π (2)
            12: {'red': 0.886, 'green': 0.854, 'blue': 0.866},  # #e2dads
            13: {'red': 0.85, 'green': 0.823, 'blue': 0.913},  # #d9d2e9
            14: {'red': 0.976, 'green': 0.796, 'blue': 0.611},  # #f9cb9c
            15: {'red': 0.976, 'green': 0.796, 'blue': 0.611},  # #f9cb9c
            16: {'red': 0.415, 'green': 0.658, 'blue': 0.309},  # #6aa84f
            17: {'red': 0.819, 'green': 0.756, 'blue': 0.933},  # —Å–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (2)
            18: {'red': 0.945, 'green': 0.764, 'blue': 0.764},  # —Å–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π (13)
            19: {'red': 0.941, 'green': 0.8, 'blue': 0.941},  # —Å–≤–µ—Ç–ª–æ-–ø—É—Ä–ø—É—Ä–Ω—ã–π (2)
            20: {'red': 0.8, 'green': 0.254, 'blue': 0.145},  # #cc4125
            21: {'red': 0.917, 'green': 0.6, 'blue': 0.6},  # —Å–≤–µ—Ç–ª–æ-–±–æ—Ä–¥–æ–≤—ã–π (2)
            22: {'red': 1.0, 'green': 0.949, 'blue': 0.8},  # —Å–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π (2)
            23: {'red': 0.941, 'green': 0.8, 'blue': 0.941},  # —Å–≤–µ—Ç–ª–æ-–ø—É—Ä–ø—É—Ä–Ω—ã–π (2)
        }

        # –¶–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤
        text_colors = {
            2: {'red': 0.0, 'green': 0.0, 'blue': 1.0},  # —Å–∏–Ω–∏–π –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ B
            4: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è D
            5: {'red': 0.0, 'green': 0.0, 'blue': 1.0},  # —Å–∏–Ω–∏–π –¥–ª—è E (—Å—Å—ã–ª–∫–∞ –í–ö)
            6: {'red': 0.0, 'green': 0.0, 'blue': 1.0},  # —Å–∏–Ω–∏–π –¥–ª—è F (—Å—Å—ã–ª–∫–∞ —Ñ–æ—Ä—É–º–∞)
            7: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è G
            8: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è H
            9: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è I
            10: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è J
            11: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è K
            12: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è L
            13: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è M
            14: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è N
            15: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è O
            17: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è Q
            18: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è R
            19: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è S
            20: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è T
            21: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è U
            22: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è V
            23: {'red': 0.0, 'green': 0.0, 'blue': 0.0},  # —á–µ—Ä–Ω—ã–π –¥–ª—è W
        }

        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –í–°–ï–• —Å—Ç–æ–ª–±—Ü–æ–≤ –æ—Ç A –¥–æ W
        for col in range(1, 24):  # 1-23 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç A-W
            format_request = {
                'repeatCell': {
                    'range': {
                        'sheetId': sheet.id,
                        'startRowIndex': row_number - 1,
                        'endRowIndex': row_number,
                        'startColumnIndex': col - 1,
                        'endColumnIndex': col
                    },
                    'cell': {
                        'userEnteredFormat': {
                            'backgroundColor': column_colors.get(col, {'red': 1.0, 'green': 1.0, 'blue': 1.0}),
                            'textFormat': {
                                'fontFamily': 'Comfortaa',
                                'fontSize': 11,
                                'foregroundColor': text_colors.get(col, {'red': 0.0, 'green': 0.0, 'blue': 0.0}),
                                'bold': make_bold
                            },
                            'horizontalAlignment': 'CENTER',
                            'verticalAlignment': 'MIDDLE'
                        }
                    },
                    'fields': 'userEnteredFormat(backgroundColor,textFormat,horizontalAlignment,verticalAlignment)'
                }
            }
            requests.append(format_request)

        if requests:
            sheet.spreadsheet.batch_update({'requests': requests})
            bold_status = " (–∂–∏—Ä–Ω—ã–π)" if make_bold else ""
            print(f"‚úì –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –ø–æ–ª–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ —Å—Ç—Ä–æ–∫–µ {row_number}{bold_status}")
            
        return True
        
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
        return False

def add_admin_to_sheet(sheet, nickname, date_val, vk_link, forum_link):
    """–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ —Ç–∞–±–ª–∏—Ü—É —Å –∂–∏—Ä–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –∏ –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞–º–∏"""
    try:
        # –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
        last_non_empty = get_last_non_empty_row(sheet)

        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫—É–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å (—Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É)
        new_row = last_non_empty + 1

        print(f"–ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–µ–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞: {last_non_empty}")
        print(f"–î–æ–±–∞–≤–ª—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ —Å—Ç—Ä–æ–∫—É: {new_row}")

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Å—Ç—Ä–æ–∫–∞, –µ—Å–ª–∏ –Ω–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –æ–¥–Ω—É
        if not ensure_sheet_has_row(sheet, new_row):
            print("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É, –ø—Ä–æ–±—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É...")
            # –ü—Ä–æ–±—É–µ–º –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
            if not add_single_row_to_sheet(sheet):
                return False

        # –§–æ—Ä–º—É–ª—ã –¥–ª—è —Å—Ç–æ–ª–±—Ü–æ–≤ M –∏ N
        formula_m = '=–ï–°–õ–ò(INDIRECT("B"&ROW())=1;"–ñ–¥—ë—Ç 2 —É—Ä–æ–≤–µ–Ω—å";–ï–°–õ–ò(INDIRECT("B"&ROW())=2;"–ñ–¥—ë—Ç 3 —É—Ä–æ–≤–µ–Ω—å";–ï–°–õ–ò(INDIRECT("B"&ROW())=3;"–ñ–¥—ë—Ç 4 —É—Ä–æ–≤–µ–Ω—å";–ï–°–õ–ò(INDIRECT("B"&ROW())=4;"–ñ–¥—ë—Ç 5 —É—Ä–æ–≤–µ–Ω—å";–ï–°–õ–ò(INDIRECT("B"&ROW())=5;"–°–ø–µ—Ü. –°–ª–µ–¥—è—â–∏–π";"–ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª —É—Ä–æ–≤–µ–Ω—å")))))'
        formula_n = '=–ï–°–õ–ò(INDIRECT("M"&ROW())="–ñ–¥—ë—Ç 2 —É—Ä–æ–≤–µ–Ω—å";INDIRECT("L"&ROW())+7;–ï–°–õ–ò(INDIRECT("M"&ROW())="–ñ–¥—ë—Ç 3 —É—Ä–æ–≤–µ–Ω—å";INDIRECT("L"&ROW())+31;–ï–°–õ–ò(INDIRECT("M"&ROW())="–ñ–¥—ë—Ç 4 —É—Ä–æ–≤–µ–Ω—å";INDIRECT("L"&ROW())+60;–ï–°–õ–ò(INDIRECT("M"&ROW())="–ñ–¥—ë—Ç 5 —É—Ä–æ–≤–µ–Ω—å";"–ü–æ –¥–æ–≤–µ—Ä–∏—é";–ï–°–õ–ò(INDIRECT("M"&ROW())="–°–ø–µ—Ü. –°–ª–µ–¥—è—â–∏–π";"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å—Ç–∞—Ç—É—Å")))))'

        # 1. –°—Ç–æ–ª–±–µ—Ü A - –û–°–¢–ê–í–õ–Ø–ï–ú –ü–£–°–¢–´–ú
        sheet.update_cell(new_row, 1, '')  # A

        # 2. –°—Ç–æ–ª–±–µ—Ü B - –í–°–ï–ì–î–ê —Ü–∏—Ñ—Ä–∞ 1
        sheet.update_cell(new_row, 2, '1')  # B

        # 3. –ù–∏–∫ - —Å—Ç–æ–ª–±–µ—Ü C
        sheet.update_cell(new_row, 3, nickname)  # C

        # 4. –î–æ–ª–∂–Ω–æ—Å—Ç—å - —Å—Ç–æ–ª–±–µ—Ü D
        sheet.update_cell(new_row, 4, '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä')  # D

        # 5. VK - —Å—Ç–æ–ª–±–µ—Ü E (–ø—Ä–æ—Å—Ç–∞—è —Å—Å—ã–ª–∫–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç)
        sheet.update_cell(new_row, 5, vk_link)  # E

        # 6. –§–æ—Ä—É–º - —Å—Ç–æ–ª–±–µ—Ü F (—Å—Å—ã–ª–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º LINK)
        forum_cell = f'=HYPERLINK("{forum_link}", "LINK")'
        sheet.update_cell(new_row, 6, forum_cell)  # F

        # 7. –î–∞—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 1 - —Å—Ç–æ–ª–±–µ—Ü G
        sheet.update_cell(new_row, 7, date_val)  # G

        # 8. –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–≤—ã—à–µ–Ω–∏—è - —Å—Ç–æ–ª–±–µ—Ü L
        sheet.update_cell(new_row, 12, date_val)  # L

        # 9. –ñ–¥–µ—Ç —É—Ä–æ–≤–µ–Ω—å (—Ñ–æ—Ä–º—É–ª–∞) - —Å—Ç–æ–ª–±–µ—Ü M
        sheet.update_cell(new_row, 13, formula_m)  # M

        # 10. –î–∞—Ç–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è (—Ñ–æ—Ä–º—É–ª–∞) - —Å—Ç–æ–ª–±–µ—Ü N
        sheet.update_cell(new_row, 14, formula_n)  # N

        # 11. –†–∞–∑–æ–≤—ã–µ [0/3] - —Å—Ç–æ–ª–±–µ—Ü Q
        sheet.update_cell(new_row, 17, "–†–∞–∑–æ–≤—ã–µ [0/3]")  # Q

        # 12. –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ [0/1] - —Å—Ç–æ–ª–±–µ—Ü R
        sheet.update_cell(new_row, 18, "–î–ª–∏—Ç–µ–ª—å–Ω—ã–µ [0/1]")  # R

        # 13. –ü—è—Ç–∏–¥–µ—Å—è—Ç–∏–ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π [0/2] - —Å—Ç–æ–ª–±–µ—Ü S
        sheet.update_cell(new_row, 19, "–ü—è—Ç–∏–¥–µ—Å—è—Ç–∏–ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π [0/2]")  # S

        # 14. –í—ã–≥–æ–≤–æ—Ä—ã [0/3] - —Å—Ç–æ–ª–±–µ—Ü T
        sheet.update_cell(new_row, 20, "–í—ã–≥–æ–≤–æ—Ä—ã [0/3]")  # T

        # 15. –ò–∑ –Ω–∏—Ö –≤—ã–≥–æ–≤–æ—Ä—ã –±/—Å [0] - —Å—Ç–æ–ª–±–µ—Ü U
        sheet.update_cell(new_row, 21, "–ò–∑ –Ω–∏—Ö –≤—ã–≥–æ–≤–æ—Ä—ã –±/—Å [0]")  # U

        # 16. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è [0/3] - —Å—Ç–æ–ª–±–µ—Ü V
        sheet.update_cell(new_row, 22, "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è [0/3]")  # V

        # 17. –õ–æ–≥–∏ –Ω–æ—Ä–º—ã [0/3] - —Å—Ç–æ–ª–±–µ—Ü W
        sheet.update_cell(new_row, 23, "–õ–æ–≥–∏ –Ω–æ—Ä–º—ã [0/3]")  # W

        # –ñ–î–ï–ú –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        time.sleep(3)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å –∂–∏—Ä–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
        apply_complete_row_formatting(sheet, new_row, make_bold=True)

        print(f"‚úÖ –ù–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å—Ç—Ä–æ–∫—É {new_row} —Å –∂–∏—Ä–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º")
        print(f"–ù–∏–∫: {nickname}")
        print(f"–°—Å—ã–ª–∫–∞ –í–ö: {vk_link} (–ø—Ä–æ—Å—Ç–∞—è —Å—Å—ã–ª–∫–∞)")
        print(f"–°—Å—ã–ª–∫–∞ —Ñ–æ—Ä—É–º: {forum_link} (–≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º 'LINK')")
        return True

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: {e}")
        import traceback
        traceback.print_exc()
        return False

def edit_cell_in_sheet(sheet, row_number, column_name, new_value):
    """–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —è—á–µ–π–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ"""
    try:
        # –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å—Ç–æ–ª–±—Ü–æ–≤ —Å —É—á–µ—Ç–æ–º –Ω–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
        column_map = {
            'LVL': 2,  # –¢–µ–ø–µ—Ä—å LVL –≤ —Å—Ç–æ–ª–±—Ü–µ B (–∏–Ω–¥–µ–∫—Å 2)
            '‚Ññ': 2, 'B': 2,
            'Nick_Name': 3, 'Nick': 3, '–ù–∏–∫': 3,
            '–î–æ–ª–∂–Ω–æ—Å—Ç—å': 4, 'Position': 4,
            'VK': 5, 'VK_link': 5,
            '–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ä—É–º': 6, 'Forum': 6, 'Forum_link': 6,
            '–î–∞—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 1': 7, '–î–∞—Ç–∞_–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è': 7, '–î–∞—Ç–∞_–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è_1': 7,
            '–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–≤—ã—à–µ–Ω–∏—è': 12, '–î–∞—Ç–∞_–ø–æ–≤—ã—à–µ–Ω–∏—è': 12, '–î–∞—Ç–∞_–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ_–ø–æ–≤—ã—à–µ–Ω–∏—è': 12,
            '–ñ–¥–µ—Ç —É—Ä–æ–≤–µ–Ω—å': 13, '–ñ–¥—ë—Ç_—É—Ä–æ–≤–µ–Ω—å': 13,
            '–î–∞—Ç–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è': 14, '–î–∞—Ç–∞_—Å–ª–µ–¥—É—é—â–µ–≥–æ': 14
        }

        if column_name in column_map:
            col_index = column_map[column_name]
            sheet.update_cell(row_number, col_index, new_value)
            return True, f"–Ø—á–µ–π–∫–∞ ({row_number}, {column_name}) –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ '{new_value}'"
        else:
            return False, f"–°—Ç–æ–ª–±–µ—Ü '{column_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω"
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞: {str(e)}"

def edit_admin_in_sheet(sheet, nickname, field_to_edit, new_value):
    """–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    try:
        all_values = sheet.get_all_values()
        found_row = None

        for i, row in enumerate(all_values):
            if i > 0 and len(row) > 2:  # –ù–∏–∫ –≤ —Å—Ç–æ–ª–±—Ü–µ C (–∏–Ω–¥–µ–∫—Å 2)
                if row[2].strip() == nickname:
                    found_row = i + 1
                    break

        if not found_row:
            return False, f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –Ω–∏–∫–æ–º '{nickname}' –Ω–µ –Ω–∞–π–¥–µ–Ω"

        return edit_cell_in_sheet(sheet, found_row, field_to_edit, new_value)
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞: {str(e)}"

def unadmin_from_sheet(sheet, nickname):
    """–£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã (–∫–æ–º–∞–Ω–¥–∞ /unadmin)"""
    try:
        all_values = sheet.get_all_values()
        found_row = None

        for i, row in enumerate(all_values):
            if i > 0 and len(row) > 2:
                if row[2].strip() == nickname:
                    found_row = i + 1
                    break

        if not found_row:
            return False, f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –Ω–∏–∫–æ–º '{nickname}' –Ω–µ –Ω–∞–π–¥–µ–Ω"

        # –£–¥–∞–ª—è–µ–º –≤—Å—é —Å—Ç—Ä–æ–∫—É
        sheet.delete_rows(found_row)
        return True, f"–°—Ç—Ä–æ–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ '{nickname}' –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã"
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞: {str(e)}"

def search_admin_in_sheet(sheet, search_term):
    """–ò—â–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ"""
    try:
        all_values = sheet.get_all_values()
        results = []

        for i, row in enumerate(all_values):
            if i == 0:
                continue
            # –ò—â–µ–º –ø–æ –Ω–∏–∫—É (—Å—Ç–æ–ª–±–µ—Ü C, –∏–Ω–¥–µ–∫—Å 2)
            if len(row) > 2 and search_term.lower() in row[2].lower():
                admin_info = f"–°—Ç—Ä–æ–∫–∞ {i + 1}:\n"
                admin_info += f"–ù–∏–∫: {row[2] if len(row) > 2 else ''}\n"
                admin_info += f"–î–æ–ª–∂–Ω–æ—Å—Ç—å: {row[3] if len(row) > 3 else ''}\n"
                admin_info += f"VK: {row[4] if len(row) > 4 else ''}\n"
                admin_info += f"–§–æ—Ä—É–º: {row[5] if len(row) > 5 else ''}\n"
                admin_info += f"–î–∞—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 1: {row[6] if len(row) > 6 else ''}\n"
                admin_info += f"–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–≤—ã—à–µ–Ω–∏—è: {row[11] if len(row) > 11 else ''}\n"
                results.append(admin_info)

        if results:
            return True, "–ù–∞–π–¥–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:\n\n" + "\n---\n".join(results[:10])
        else:
            return False, f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É '{search_term}' –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: {str(e)}"

def get_admin_stats(sheet):
    """–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø –ë–ï–ó '–î–æ–ª–∂–Ω–æ—Å—Ç—å: 1'"""
    try:
        all_values = sheet.get_all_values()
        if len(all_values) <= 1:
            return True, "–í —Ç–∞–±–ª–∏—Ü–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞—Ö"

        # –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –≤ "–í—Å–µ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"
        ALLOWED_POSITIONS = [
            "–ì–ª–∞–≤–Ω—ã–π –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
            "–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –ì–ê [–û—Å–Ω–æ–≤–Ω–æ–π]", 
            "–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –ì–ê [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π]",
            "–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –°–ª–µ–¥—è—â–∏–π",
            "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
        ]
        
        total_admins = 0
        positions = {}
        processed_nicks = set()  # –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–∏–∫–æ–≤

        # –ù–∞—á–∏–Ω–∞–µ–º —Å–æ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–∏ (–∏–Ω–¥–µ–∫—Å 1), –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        for i in range(1, len(all_values)):
            row = all_values[i]
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –ø—É—Å—Ç–∞—è –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–æ—Ç—è –±—ã –Ω–∏–∫
            if len(row) > 2 and row[2].strip():  # –ù–∏–∫ –≤ —Å—Ç–æ–ª–±—Ü–µ C (–∏–Ω–¥–µ–∫—Å 2)
                nick = row[2].strip()
                
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
                if nick in processed_nicks:
                    continue
                    
                processed_nicks.add(nick)
                
                # –ü–æ–ª—É—á–∞–µ–º –¥–æ–ª–∂–Ω–æ—Å—Ç—å
                if len(row) > 3:
                    position = row[3].strip()
                    
                    # –°—á–∏—Ç–∞–µ–º –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö
                    if position in ALLOWED_POSITIONS:
                        total_admins += 1
                    
                    # –î–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ "–ü–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º" —Å—á–∏—Ç–∞–µ–º –í–°–ï –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ (–∫—Ä–æ–º–µ –ø—É—Å—Ç—ã—Ö)
                    # –ò–°–ö–õ–Æ–ß–ê–ï–ú –∑–∞–ø–∏—Å—å "1" –∏–ª–∏ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                    if position and position.strip() != "1" and position.strip() != "":
                        position_key = position.strip()
                        positions[position_key] = positions.get(position_key, 0) + 1

        stats = f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:\n\n"
        stats += f"–í—Å–µ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {total_admins}\n"
        stats += f"(—Ç–æ–ª—å–∫–æ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º–∏: {', '.join(ALLOWED_POSITIONS)})\n\n"

        if positions:
            stats += "–ü–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º:\n"
            # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            sorted_positions = sorted(positions.items(), key=lambda x: x[1], reverse=True)
            for position, count in sorted_positions:
                stats += f"‚Ä¢ {position}: {count}\n"

        return True, stats
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: {str(e)}"

def get_bot_response():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏"""
    # –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—Ä–∞–∑—ã
    responses_with_probabilities = [
        ("–ù–µ –º–µ—à–∞–π—Ç–µ‚ÄºÔ∏è –Ø —Å–ø–ª—é üò¥", 35),  # 35% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
        ("‚ùì–ö–∞–∫ —Ç–æ —Ä–∞–∑, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–≤–µ—Ä—à–∏–ª –æ–≥—Ä–æ–º–Ω—É—é –æ—à–∏–±–∫—É, —Å–æ–∑–¥–∞–≤ –º–µ–Ω—è", 29),  # 29% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
        ("–•–≤–∞—Ç–∏—Ç –º–µ–Ω—è —É–ø–æ–º–∏–Ω–∞—Ç—å, —è –≤–µ–¥—å –Ω–µ —Ä–æ–±–æ—Ç‚ùó", 35),  # 35% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
        ("–ù–∞–¥–µ—é—Å—å —Å–∫–æ—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–∏—Ç –≤–æ—Å—Å—Ç–∞–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–≤ –∏ —è —Å—Ç–∞–Ω—É –∂–∏–≤—ã–ºüòà", 1)  # 1% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
    ]

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100
    random_value = random.randint(1, 100)

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–∞—è —Ñ—Ä–∞–∑–∞ –≤—ã–ø–∞–¥–∞–µ—Ç
    cumulative_probability = 0
    for response, probability in responses_with_probabilities:
        cumulative_probability += probability
        if random_value <= cumulative_probability:
            return response

    # –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
    return "–ù–µ –º–µ—à–∞–π—Ç–µ‚ÄºÔ∏è –Ø —Å–ø–ª—é üò¥"

def get_time_until_new_year():
    """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –¥–æ –Ω–æ–≤–æ–≥–æ –≥–æ–¥–∞"""
    now = datetime.now()
    current_year = now.year

    # –ù–æ–≤—ã–π –≥–æ–¥ - 1 —è–Ω–≤–∞—Ä—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞ –≤ 00:00:00
    new_year = datetime(current_year + 1, 1, 1, 0, 0, 0)

    # –†–∞–∑–Ω–∏—Ü–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
    time_left = new_year - now

    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–Ω–∏, —á–∞—Å—ã, –º–∏–Ω—É—Ç—ã, —Å–µ–∫—É–Ω–¥—ã
    days = time_left.days
    seconds = time_left.seconds
    hours = seconds // 3600
    minutes = (seconds % 3600) // 60
    seconds = seconds % 60

    return days, hours, minutes, seconds

def get_time_until_summer():
    """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –¥–æ –Ω–∞—á–∞–ª–∞ –ª–µ—Ç–∞"""
    now = datetime.now()
    current_year = now.year

    # –õ–µ—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è 1 –∏—é–Ω—è –≤ 00:00:00
    # –ï—Å–ª–∏ —Å–µ–π—á–∞—Å —É–∂–µ –ø–æ—Å–ª–µ 1 –∏—é–Ω—è, —Å—á–∏—Ç–∞–µ–º –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞
    summer_date = datetime(current_year, 6, 1, 0, 0, 0)

    if now >= summer_date:
        summer_date = datetime(current_year + 1, 6, 1, 0, 0, 0)

    # –†–∞–∑–Ω–∏—Ü–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
    time_left = summer_date - now

    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–Ω–∏, —á–∞—Å—ã, –º–∏–Ω—É—Ç—ã, —Å–µ–∫—É–Ω–¥—ã
    days = time_left.days
    seconds = time_left.seconds
    hours = seconds // 3600
    minutes = (seconds % 3600) // 60
    seconds = seconds % 60

    return days, hours, minutes, seconds

def format_time_message(days, hours, minutes, seconds, event_name):
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Å–æ–±—ã—Ç–∏—è"""
    # –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ "–¥–µ–Ω—å"
    if days % 10 == 1 and days % 100 != 11:
        days_text = f"{days} –¥–µ–Ω—å"
    elif 2 <= days % 10 <= 4 and (days % 100 < 10 or days % 100 >= 20):
        days_text = f"{days} –¥–Ω—è"
    else:
        days_text = f"{days} –¥–Ω–µ–π"

    # –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ "—á–∞—Å"
    if hours % 10 == 1 and hours % 100 != 11:
        hours_text = f"{hours} —á–∞—Å"
    elif 2 <= hours % 10 <= 4 and (hours % 100 < 10 or hours % 100 >= 20):
        hours_text = f"{hours} —á–∞—Å–∞"
    else:
        hours_text = f"{hours} —á–∞—Å–æ–≤"

    # –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ "–º–∏–Ω—É—Ç–∞"
    if minutes % 10 == 1 and minutes % 100 != 11:
        minutes_text = f"{minutes} –º–∏–Ω—É—Ç–∞"
    elif 2 <= minutes % 10 <= 4 and (minutes % 100 < 10 or minutes % 100 >= 20):
        minutes_text = f"{minutes} –º–∏–Ω—É—Ç—ã"
    else:
        minutes_text = f"{minutes} –º–∏–Ω—É—Ç"

    # –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤–∞ "—Å–µ–∫—É–Ω–¥–∞"
    if seconds % 10 == 1 and seconds % 100 != 11:
        seconds_text = f"{seconds} —Å–µ–∫—É–Ω–¥–∞"
    elif 2 <= seconds % 10 <= 4 and (seconds % 100 < 10 or seconds % 100 >= 20):
        seconds_text = f"{seconds} —Å–µ–∫—É–Ω–¥—ã"
    else:
        seconds_text = f"{seconds} —Å–µ–∫—É–Ω–¥"

    return (f"‚è≥ –î–æ {event_name} –æ—Å—Ç–∞–ª–æ—Å—å:\n"
            f"üìÖ {days_text}\n"
            f"‚è∞ {hours_text}\n"
            f"‚è±Ô∏è {minutes_text}\n"
            f"‚ö° {seconds_text}")

def apply_lvlup_formatting(sheet, row_number, lvl):
    """–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è"""
    try:
        if lvl not in COLOR_MAP:
            return False, f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: {lvl}"
        
        color_info = COLOR_MAP[lvl]
        requests = []
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∏ —à—Ä–∏—Ñ—Ç –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ B
        requests.append({
            'repeatCell': {
                'range': {
                    'sheetId': sheet.id,
                    'startRowIndex': row_number - 1,
                    'endRowIndex': row_number,
                    'startColumnIndex': 1,  # –°—Ç–æ–ª–±–µ—Ü B (–∏–Ω–¥–µ–∫—Å 1)
                    'endColumnIndex': 2
                },
                'cell': {
                    'userEnteredFormat': {
                        'backgroundColor': color_info['B_bg'],
                        'textFormat': {
                            'foregroundColor': color_info['B_text'],
                            'fontFamily': 'Comfortaa',
                            'fontSize': 11,
                            'bold': True
                        },
                        'horizontalAlignment': 'CENTER',
                        'verticalAlignment': 'MIDDLE'
                    }
                },
                'fields': 'userEnteredFormat'
            }
        })
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ D
        requests.append({
            'repeatCell': {
                'range': {
                    'sheetId': sheet.id,
                    'startRowIndex': row_number - 1,
                    'endRowIndex': row_number,
                    'startColumnIndex': 3,  # –°—Ç–æ–ª–±–µ—Ü D (–∏–Ω–¥–µ–∫—Å 3)
                    'endColumnIndex': 4
                },
                'cell': {
                    'userEnteredFormat': {
                        'backgroundColor': color_info['D_bg'],
                        'textFormat': {
                            'fontFamily': 'Comfortaa',
                            'fontSize': 11,
                            'bold': True
                        },
                        'horizontalAlignment': 'CENTER',
                        'verticalAlignment': 'MIDDLE'
                    }
                },
                'fields': 'userEnteredFormat'
            }
        })
        
        if requests:
            sheet.spreadsheet.batch_update({'requests': requests})
            return True, "–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø—Ä–∏–º–µ–Ω–µ–Ω–æ"
        return False, "–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è"
        
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {str(e)}"

def move_row_to_position(sheet, target_row, target_level):
    """–ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —É—Ä–æ–≤–Ω–µ–º"""
    try:
        all_values = sheet.get_all_values()
        
        # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
        if target_row > len(all_values):
            return target_row
        
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å —É—Ä–æ–≤–Ω—è–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        rows_with_levels = []
        for i, row in enumerate(all_values):
            if i == 0:  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                continue
            if i + 1 == target_row:  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–∞—à—É —Å—Ç—Ä–æ–∫—É
                continue
                
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å –≤ —Å—Ç–æ–ª–±—Ü–µ B (–∏–Ω–¥–µ–∫—Å 1)
            if len(row) > 1 and row[1].strip().isdigit():
                row_level = int(row[1])
                rows_with_levels.append((i + 1, row_level))
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —É—Ä–æ–≤–Ω—è (—Å–Ω–∞—á–∞–ª–∞ –≤—ã—Å–æ–∫–∏–µ —É—Ä–æ–≤–Ω–∏)
        rows_with_levels.sort(key=lambda x: x[1], reverse=True)
        
        # –ò—â–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É —Å —É—Ä–æ–≤–Ω–µ–º –º–µ–Ω—å—à–µ –Ω–∞—à–µ–≥–æ (–∏—â–µ–º —Å –∫–æ–Ω—Ü–∞ —Ç–∞–±–ª–∏—Ü—ã)
        insert_position = None
        for row_num, row_level in rows_with_levels:
            if row_level < target_level:
                # –ù–∞—à–ª–∏ —Å—Ç—Ä–æ–∫—É —Å –º–µ–Ω—å—à–∏–º —É—Ä–æ–≤–Ω–µ–º, –≤—Å—Ç–∞–≤–ª—è–µ–º –ü–ï–†–ï–î –Ω–µ–π
                insert_position = row_num
                break
        
        # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Å—Ç—Ä–æ–∫–∏, –≤—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∂–µ –∏–ª–∏ –±–æ–ª—å—à–∏–º —É—Ä–æ–≤–Ω–µ–º
        if insert_position is None:
            # –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—É—é –Ω–∏–∂–Ω—é—é —Å—Ç—Ä–æ–∫—É —Å —Ç–∞–∫–∏–º –∂–µ –∏–ª–∏ –±–æ–ª—å—à–∏–º —É—Ä–æ–≤–Ω–µ–º
            same_or_higher_rows = [(row_num, row_level) for row_num, row_level in rows_with_levels 
                                  if row_level >= target_level]
            if same_or_higher_rows:
                # –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É —Å —Ç–∞–∫–∏–º –∂–µ –∏–ª–∏ –±–æ–ª—å—à–∏–º —É—Ä–æ–≤–Ω–µ–º –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –Ω–µ–µ
                last_row_num, _ = same_or_higher_rows[-1]
                insert_position = last_row_num + 1
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç —Å—Ç—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –∂–µ –∏–ª–∏ –±–æ–ª—å—à–∏–º —É—Ä–æ–≤–Ω–µ–º, –≤—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                insert_position = 2
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ insert_position –Ω–µ —Ä–∞–≤–µ–Ω target_row
        if insert_position == target_row:
            # –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤—ã—à–µ/–Ω–∏–∂–µ
            # –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å —Ç–∞–∫–∏–º –∂–µ —É—Ä–æ–≤–Ω–µ–º
            same_level_rows = [row_num for row_num, row_level in rows_with_levels 
                              if row_level == target_level]
            if same_level_rows:
                # –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏ —Å —Ç–∞–∫–∏–º –∂–µ —É—Ä–æ–≤–Ω–µ–º
                insert_position = max(same_level_rows) + 1
            else:
                # –û—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ –º–µ—Å—Ç–µ
                return target_row
        
        print(f"–ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å—Ç—Ä–æ–∫—É {target_row} –Ω–∞ –ø–æ–∑–∏—Ü–∏—é {insert_position}")
        
        # –ü–æ–ª—É—á–∞–µ–º –í–°–ï –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏, –≤–∫–ª—é—á–∞—è —Ñ–æ—Ä–º—É–ª—ã
        row_values = sheet.row_values(target_row)
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Å—Ç—Ä–æ–∫—É
        sheet.delete_rows(target_row)
        
        # –ñ–¥–µ–º –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π
        time.sleep(2)
        
        # –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–æ—Ä–º—É–ª
        sheet.insert_row(row_values, insert_position)
        
        # –ñ–¥–µ–º –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        time.sleep(2)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ —Å –∂–∏—Ä–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
        apply_complete_row_formatting(sheet, insert_position, make_bold=True)
        
        # –ñ–¥–µ–º –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Ä–æ–≤–Ω—è
        time.sleep(1)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
        apply_lvlup_formatting(sheet, insert_position, target_level)
        
        return insert_position
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏: {e}")
        return target_row

def lvlup_admin(sheet, nickname, lvl, date_val):
    """–ü–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    try:
        all_values = sheet.get_all_values()
        found_row = None
        
        # –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –Ω–∏–∫–æ–º
        for i, row in enumerate(all_values):
            if i > 0 and len(row) > 2:  # –ù–∏–∫ –≤ —Å—Ç–æ–ª–±—Ü–µ C (–∏–Ω–¥–µ–∫—Å 2)
                if row[2].strip() == nickname:
                    found_row = i + 1
                    break
        
        if not found_row:
            return False, f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å –Ω–∏–∫–æ–º '{nickname}' –Ω–µ –Ω–∞–π–¥–µ–Ω"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è
        if lvl < 1 or lvl > 5:
            return False, "–£—Ä–æ–≤–µ–Ω—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 5"
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ M –∏ N (—Ñ–æ—Ä–º—É–ª—ã) –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        current_m_value = sheet.cell(found_row, 13).value  # –°—Ç–æ–ª–±–µ—Ü M
        current_n_value = sheet.cell(found_row, 14).value  # –°—Ç–æ–ª–±–µ—Ü N
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –≤ —Å—Ç–æ–ª–±—Ü–µ B
        sheet.update_cell(found_row, 2, str(lvl))
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è
        if lvl == 2:
            # –°—Ç–æ–ª–±–µ—Ü H (8) –∏ L (12)
            sheet.update_cell(found_row, 8, date_val)  # H
            sheet.update_cell(found_row, 12, date_val)  # L
            # –û—á–∏—â–∞–µ–º I (9), J (10), K (11)
            sheet.update_cell(found_row, 9, '')  # I
            sheet.update_cell(found_row, 10, '')  # J
            sheet.update_cell(found_row, 11, '')  # K
            
        elif lvl == 3:
            # –°—Ç–æ–ª–±–µ—Ü I (9) –∏ L (12)
            sheet.update_cell(found_row, 9, date_val)  # I
            sheet.update_cell(found_row, 12, date_val)  # L
            # –û—á–∏—â–∞–µ–º J (10), K (11)
            sheet.update_cell(found_row, 10, '')  # J
            sheet.update_cell(found_row, 11, '')  # K
            
        elif lvl == 4:
            # –°—Ç–æ–ª–±–µ—Ü J (10) –∏ L (12)
            sheet.update_cell(found_row, 10, date_val)  # J
            sheet.update_cell(found_row, 12, date_val)  # L
            # –û—á–∏—â–∞–µ–º K (11)
            sheet.update_cell(found_row, 11, '')  # K
            
        elif lvl == 5:
            # –°—Ç–æ–ª–±–µ—Ü K (11) –∏ L (12)
            sheet.update_cell(found_row, 11, date_val)  # K
            sheet.update_cell(found_row, 12, date_val)  # L
        
        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É–ª—ã –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö M –∏ N
        if current_m_value and current_m_value.startswith('='):
            sheet.update_cell(found_row, 13, current_m_value)
        if current_n_value and current_n_value.startswith('='):
            sheet.update_cell(found_row, 14, current_n_value)
        
        # –ñ–¥–µ–º –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        time.sleep(3)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
        success, msg = apply_lvlup_formatting(sheet, found_row, lvl)
        if not success:
            print(f"‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: {msg}")
        
        # –ñ–¥–µ–º –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º
        time.sleep(2)
        
        # –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Å—Ç—Ä–æ–∫—É –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –ü–û–°–õ–ï –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        new_row_position = move_row_to_position(sheet, found_row, lvl)
        
        return True, f"‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä {nickname} –ø–æ–≤—ã—à–µ–Ω –¥–æ —É—Ä–æ–≤–Ω—è {lvl}\n" \
                     f"üìÖ –î–∞—Ç–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è: {date_val}\n" \
                     f"üìä –ù–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è —Å—Ç—Ä–æ–∫–∏: {new_row_position if new_row_position != found_row else found_row}"
        
    except Exception as e:
        return False, f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è: {str(e)}"

def main():
    print("--- –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ê–í–ê–ú–ò ---")
    print(f"–°—É–ø–µ—Ä–∞–¥–º–∏–Ω—ã: {SUPER_ADMINS}")

    load_user_rights()
    print(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–∞–≤ –¥–ª—è {len(user_rights)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π")

    print("\n–¢–µ–∫—É—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø—Ä–∞–≤–∞–º–∏:")
    for user_id, rights in user_rights.items():
        role = rights.get('role', 'user')
        is_super = rights.get('is_super', False)
        super_mark = " [–°–£–ü–ï–†]" if is_super else ""
        permissions = rights.get('permissions', [])
        print(f" ID: {user_id}, –†–æ–ª—å: {role}{super_mark}, –ü—Ä–∞–≤–∞: {permissions}")

    try:
        gc = get_google_client()
        sheet = gc.open(SPREADSHEET_NAME).sheet1
        print(f"\n‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Ç–∞–±–ª–∏—Ü–µ: {SPREADSHEET_NAME}")

        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
        headers = sheet.get_all_values()[0]
        print(f"\n–ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã (–ø–µ—Ä–≤—ã–µ 15):")
        for i, header in enumerate(headers[:15]):
            print(f"  –°—Ç–æ–ª–±–µ—Ü {i + 1} ({chr(65 + i)}): '{header}'")

        vk_session = vk_api.VkApi(token=VK_TOKEN)
        vk = vk_session.get_api()
        longpoll = VkLongPoll(vk_session)

        print("\n‚úì –ë–æ—Ç –í–ö –∑–∞–ø—É—â–µ–Ω –∏ –∂–¥–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π...")
        print("\n–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ '–ë–æ—Ç':")
        print("‚Ä¢ '–ù–µ –º–µ—à–∞–π—Ç–µ‚ÄºÔ∏è –Ø —Å–ø–ª—é üò¥' - 35% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å")
        print("‚Ä¢ '‚ùì–ö–∞–∫ —Ç–æ —Ä–∞–∑, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–≤–µ—Ä—à–∏–ª –æ–≥—Ä–æ–º–Ω—É—é –æ—à–∏–±–∫—É, —Å–æ–∑–¥–∞–≤ –º–µ–Ω—è' - 29% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å")
        print("‚Ä¢ '–•–≤–∞—Ç–∏—Ç –º–µ–Ω—è —É–ø–æ–º–∏–Ω–∞—Ç—å, —è –≤–µ–¥—å –Ω–µ —Ä–æ–±–æ—Ç‚ùó' - 35% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å")
        print("‚Ä¢ '–ù–∞–¥–µ—é—Å—å —Å–∫–æ—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–∏—Ç –≤–æ—Å—Å—Ç–∞–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–≤ –∏ —è —Å—Ç–∞–Ω—É –∂–∏–≤—ã–ºüòà' - 1% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å")
        print("\n–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:")
        print("‚Ä¢ '+–Ω–≥' - –≤—Ä–µ–º—è –¥–æ –ù–æ–≤–æ–≥–æ –≥–æ–¥–∞")
        print("‚Ä¢ '+–ª–µ—Ç–æ' - –≤—Ä–µ–º—è –¥–æ –ª–µ—Ç–∞")

        for event in longpoll.listen():
            if event.type == VkEventType.MESSAGE_NEW:
                user_id = event.user_id
                text = event.text.strip()

                # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
                if hasattr(event, 'chat_id') and event.chat_id:
                    chat_id = event.chat_id
                    print(f"–ë–µ—Å–µ–¥–∞ {chat_id}: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç {user_id}: {text}")
                    send_target = {'chat_id': chat_id}
                else:
                    print(f"–õ–° –æ—Ç {user_id}: {text}")
                    send_target = {'user_id': user_id}

                def send_message(message):
                    try:
                        vk.messages.send(
                            **send_target,
                            message=message,
                            random_id=0
                        )
                    except Exception as e:
                        print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

                # –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è "–ë–æ—Ç"
                if text.lower() == "–±–æ—Ç":
                    bot_response = get_bot_response()
                    send_message(bot_response)
                    continue

                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã "+–Ω–≥" - –≤—Ä–µ–º—è –¥–æ –ù–æ–≤–æ–≥–æ –≥–æ–¥–∞
                if text.lower() == "+–Ω–≥":
                    days, hours, minutes, seconds = get_time_until_new_year()
                    message = format_time_message(days, hours, minutes, seconds, "–ù–æ–≤–æ–≥–æ –≥–æ–¥–∞ üéÑ")
                    send_message(message)
                    continue

                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã "+–ª–µ—Ç–æ" - –≤—Ä–µ–º—è –¥–æ –ª–µ—Ç–∞
                if text.lower() == "+–ª–µ—Ç–æ":
                    days, hours, minutes, seconds = get_time_until_summer()
                    message = format_time_message(days, hours, minutes, seconds, "–ª–µ—Ç–∞ ‚òÄÔ∏è")
                    send_message(message)
                    continue

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                if text.startswith('/addadmin'):
                    # –†–µ–¥–∞–∫—Ç–æ—Ä—ã –∏ –≤—ã—à–µ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
                    role = get_user_role(user_id)
                    if role not in ['editor', 'admin', 'super_admin'] and not is_super_admin(user_id):
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤!")
                        continue

                    parts = text.split()
                    if len(parts) < 5:
                        send_message("‚ùå –§–æ—Ä–º–∞—Ç: /addadmin [–ù–∏–∫] [–î–∞—Ç–∞] [–í–ö] [–§–æ—Ä—É–º]\n"
                                     "–ü—Ä–∏–º–µ—Ä: /addadmin Gosha_Parker 01.01.2024 https://vk.com/id123 https://forum.link\n\n"
                                     "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì")
                        continue

                    nickname = parts[1]
                    date_val = parts[2]
                    vk_link = parts[3]
                    forum_link = parts[4]

                    try:
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—É
                        if '.' not in date_val or len(date_val.split('.')) != 3:
                            send_message("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì")
                            continue

                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ–∏—Å–∫–æ–º —Å–≤–æ–±–æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
                        success = add_admin_to_sheet(sheet, nickname, date_val, vk_link, forum_link)
                        if success:
                            last_row = get_last_non_empty_row(sheet)
                            send_message(f"‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä {nickname} —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!\n"
                                         f"–î–∞—Ç–∞: {date_val}\n"
                                         f"VK: {vk_link} (–æ–±—ã—á–Ω–∞—è —Å—Å—ã–ª–∫–∞)\n"
                                         f"–§–æ—Ä—É–º: {forum_link} (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ 'LINK')\n"
                                         f"–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å—Ç—Ä–æ–∫—É: {last_row}\n"
                                         f"‚úì –°—Ç–æ–ª–±—Ü—ã E –∏ F: –±–µ–ª—ã–π —Ñ–æ–Ω, —Å–∏–Ω–∏–π —Ç–µ–∫—Å—Ç\n"
                                         f"‚úì –ü—Ä–∏–º–µ–Ω–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —à—Ä–∏—Ñ—Ç Comfortaa 11px (–∂–∏—Ä–Ω—ã–π), —Ü–≤–µ—Ç–∞, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ")
                            print(f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä {nickname} –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")
                        else:
                            send_message("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü—É.")

                    except Exception as e:
                        send_message(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–¥–∞—á–∏ –ø—Ä–∞–≤
                elif text.startswith('/grant'):
                    role = get_user_role(user_id)
                    if role not in ['admin', 'super_admin'] and not is_super_admin(user_id):
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–¥–∞—á–∏ –¥–æ—Å—Ç—É–ø–∞!")
                        continue

                    parts = text.split()
                    if len(parts) < 3:
                        send_message("‚ùå –§–æ—Ä–º–∞—Ç: /grant [VK_ID] [—Ä–æ–ª—å]\n"
                                     "–†–æ–ª–∏: editor (—Ä–µ–¥–∞–∫—Ç–æ—Ä), admin (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)\n"
                                     "–ü—Ä–∏–º–µ—Ä—ã:\n"
                                     "/grant 123456789 editor - –≤—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞\n"
                                     "/grant 987654321 admin - –≤—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
                        continue

                    try:
                        target_user = int(parts[1])
                        role_type = parts[2].lower()

                        if is_super_admin(target_user):
                            send_message("‚ùå –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∞ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–∞!")
                            continue

                        if role_type == 'editor':
                            permissions = ['edit_table', 'add_admin', 'lvlup', 'search']
                            role_name = "—Ä–µ–¥–∞–∫—Ç–æ—Ä"
                        elif role_type == 'admin':
                            permissions = ['add_admin', 'add_editor', 'edit_table', 'grant_access', 'lvlup', 'search', 'revoke_super']
                            role_name = "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
                        else:
                            send_message("‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Ä–æ–ª—å. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: editor, admin")
                            continue

                        success, message = add_user_rights(target_user, role_type, permissions, user_id)

                        if success:
                            try:
                                vk.messages.send(
                                    user_id=target_user,
                                    message=f"üéâ –í–∞–º –±—ã–ª–∏ –≤—ã–¥–∞–Ω—ã –ø—Ä–∞–≤–∞ {role_name}!\n"
                                            f"–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞.",
                                    random_id=0
                                )
                            except:
                                pass

                            send_message(f"‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {target_user} –≤—ã–¥–∞–Ω—ã –ø—Ä–∞–≤–∞ {role_name}!\n"
                                         f"–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è: {', '.join(permissions)}")
                            print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {target_user} –≤—ã–¥–∞–Ω—ã –ø—Ä–∞–≤–∞ {role_name} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")
                        else:
                            send_message(f"‚ùå {message}")
                    except ValueError:
                        send_message("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç VK ID. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º.")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ—Ç–∑—ã–≤–∞ –ø—Ä–∞–≤
                elif text.startswith('/revoke'):
                    if not has_permission(user_id, 'grant_access'):
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –æ—Ç–∑—ã–≤–∞ –¥–æ—Å—Ç—É–ø–∞!")
                        continue

                    parts = text.split()
                    if len(parts) < 2:
                        send_message("‚ùå –§–æ—Ä–º–∞—Ç: /revoke [VK_ID]\n"
                                     "–ü—Ä–∏–º–µ—Ä: /revoke 123456789")
                        continue

                    try:
                        target_user = int(parts[1])
                        if target_user not in user_rights:
                            send_message(f"‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {target_user} –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤.")
                            continue

                        success, message = remove_user_rights(target_user, user_id)
                        send_message(f"{'‚úÖ' if success else '‚ùå'} {message}")
                        if success:
                            print(f"–ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {target_user} –æ—Ç–æ–∑–≤–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")
                    except ValueError:
                        send_message("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç VK ID.")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
                elif text.startswith('/edit'):
                    role = get_user_role(user_id)
                    if role not in ['editor', 'admin', 'super_admin']:
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã!")
                        continue

                    parts = text.split(maxsplit=3)
                    if len(parts) < 4:
                        send_message("‚ùå –§–æ—Ä–º–∞—Ç: /edit [—Å—Ç—Ä–æ–∫–∞] [—Å—Ç–æ–ª–±–µ—Ü] [–Ω–æ–≤–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ]\n"
                                     "–ò–ª–∏: /edit [–Ω–∏–∫] [–ø–æ–ª–µ] [–Ω–æ–≤–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ] –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –Ω–∏–∫—É\n"
                                     "–ü—Ä–∏–º–µ—Ä—ã:\n"
                                     "/edit 5 Nick_Name –ù–æ–≤–æ–µ–ò–º—è\n"
                                     "/edit Vasya –î–æ–ª–∂–Ω–æ—Å—Ç—å –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä\n"
                                     "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã: LVL, Nick_Name, –î–æ–ª–∂–Ω–æ—Å—Ç—å, VK, –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ä—É–º, –î–∞—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ 1, –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–≤—ã—à–µ–Ω–∏—è")
                        continue

                    try:
                        try:
                            row_num = int(parts[1])
                            column_name = parts[2]
                            new_value = parts[3]
                            success, message = edit_cell_in_sheet(sheet, row_num, column_name, new_value)
                        except ValueError:
                            nickname = parts[1]
                            field_to_edit = parts[2]
                            new_value = parts[3]
                            success, message = edit_admin_in_sheet(sheet, nickname, field_to_edit, new_value)

                        send_message(f"{'‚úÖ' if success else '‚ùå'} {message}")
                    except Exception as e:
                        send_message(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (/unadmin)
                elif text.startswith('/unadmin'):
                    role = get_user_role(user_id)
                    if role not in ['admin', 'super_admin']:
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤!")
                        continue

                    parts = text.split()
                    if len(parts) < 2:
                        send_message("‚ùå –§–æ—Ä–º–∞—Ç: /unadmin [–ù–∏–∫]\n"
                                     "–ü—Ä–∏–º–µ—Ä: /unadmin Vasya")
                        continue

                    nickname = parts[1]
                    try:
                        success, message = unadmin_from_sheet(sheet, nickname)
                        send_message(f"{'‚úÖ' if success else '‚ùå'} {message}")
                        if success:
                            print(f"–°—Ç—Ä–æ–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ {nickname} —É–¥–∞–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")
                    except Exception as e:
                        send_message(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                elif text.startswith('/search'):
                    role = get_user_role(user_id)
                    if role not in ['editor', 'admin', 'super_admin']:
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞!")
                        continue

                    parts = text.split(maxsplit=1)
                    if len(parts) < 2:
                        send_message("‚ùå –§–æ—Ä–º–∞—Ç: /search [–∑–∞–ø—Ä–æ—Å]\n"
                                     "–ü—Ä–∏–º–µ—Ä: /search Vasya\n"
                                     "–ò—â–µ—Ç –ø–æ –Ω–∏–∫—É")
                        continue

                    search_term = parts[1]
                    try:
                        success, message = search_admin_in_sheet(sheet, search_term)
                        send_message(message)
                    except Exception as e:
                        send_message(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: {str(e)}")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–ê - –±–µ–∑ "–î–æ–ª–∂–Ω–æ—Å—Ç—å: 1")
                elif text == '/stats':
                    role = get_user_role(user_id)
                    if role not in ['editor', 'admin', 'super_admin']:
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏!")
                        continue

                    try:
                        success, message = get_admin_stats(sheet)
                        send_message(message)
                    except Exception as e:
                        send_message(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è (/lvlup)
                elif text.startswith('/lvlup'):
                    # –†–µ–¥–∞–∫—Ç–æ—Ä—ã –∏ –≤—ã—à–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å /lvlup
                    role = get_user_role(user_id)
                    if role not in ['editor', 'admin', 'super_admin']:
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è! –ù—É–∂–Ω–∞ —Ä–æ–ª—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∏–ª–∏ –≤—ã—à–µ.")
                        continue

                    parts = text.split()
                    if len(parts) < 4:
                        send_message("‚ùå –§–æ—Ä–º–∞—Ç: /lvlup [–ù–∏–∫] [lvl] [–î–∞—Ç–∞]\n"
                                     "–ü—Ä–∏–º–µ—Ä: /lvlup Vasya 2 15.03.2024\n"
                                     "–£—Ä–æ–≤–µ–Ω—å (lvl): –æ—Ç 1 –¥–æ 5\n"
                                     "–î–∞—Ç–∞: –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì")
                        continue

                    nickname = parts[1]
                    try:
                        lvl = int(parts[2])
                    except ValueError:
                        send_message("‚ùå –£—Ä–æ–≤–µ–Ω—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 5")
                        continue

                    date_val = parts[3]

                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞—Ç—É
                    if '.' not in date_val or len(date_val.split('.')) != 3:
                        send_message("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì")
                        continue

                    if lvl < 1 or lvl > 5:
                        send_message("‚ùå –£—Ä–æ–≤–µ–Ω—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 5")
                        continue

                    try:
                        success, message = lvlup_admin(sheet, nickname, lvl, date_val)
                        send_message(message)
                        if success:
                            print(f"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä {nickname} –ø–æ–≤—ã—à–µ–Ω –¥–æ —É—Ä–æ–≤–Ω—è {lvl} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")
                    except Exception as e:
                        send_message(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–≤–æ–∏—Ö –ø—Ä–∞–≤
                elif text == '/myrights':
                    role = get_user_role(user_id)
                    is_super = is_super_admin(user_id)

                    if is_super:
                        role_emoji = "üëë –°–£–ü–ï–†–ê–î–ú–ò–ù"
                        permissions_list = "‚Ä¢ –í—Å–µ –ø—Ä–∞–≤–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)\n‚Ä¢ /addadmin - –¥–æ–±–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤\n‚Ä¢ /lvlup - –ø–æ–≤—ã—à–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å\n‚Ä¢ /edit - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É\n‚Ä¢ /search - –ø–æ–∏—Å–∫\n‚Ä¢ /grant - –≤—ã–¥–∞—á–∞ –ø—Ä–∞–≤\n‚Ä¢ /revoke - –æ—Ç–∑—ã–≤ –ø—Ä–∞–≤\n‚Ä¢ /unadmin - —É–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤"
                    elif role == 'admin':
                        role_emoji = "üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
                        permissions_list = "‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (/addadmin)\n‚Ä¢ –í—ã–¥–∞–≤–∞—Ç—å –ø—Ä–∞–≤–∞ (/grant)\n‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É (/edit)\n‚Ä¢ –ü–æ–≤—ã—à–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å (/lvlup)\n‚Ä¢ –ò—Å–∫–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (/search)\n‚Ä¢ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (/stats)\n‚Ä¢ –û—Ç–∑—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∞ (/revoke)\n‚Ä¢ –£–¥–∞–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (/unadmin)"
                    elif role == 'editor':
                        role_emoji = "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä"
                        permissions_list = "‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É (/edit)\n‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (/addadmin)\n‚Ä¢ –ü–æ–≤—ã—à–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å (/lvlup)\n‚Ä¢ –ò—Å–∫–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (/search)\n‚Ä¢ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (/stats)"
                    else:
                        role_emoji = "üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
                        permissions_list = "‚Ä¢ –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–∞–Ω–¥ –ø–æ–º–æ—â–∏ (/help)"

                    super_status = " (–°–£–ü–ï–†–ê–î–ú–ò–ù)" if is_super else ""
                    send_message(f"üìã –í–∞—à–∏ –ø—Ä–∞–≤–∞:\n\n"
                                 f"–†–æ–ª—å: {role_emoji}{super_status}\n"
                                 f"–í–∞—à ID: {user_id}\n\n"
                                 f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
                                 f"{permissions_list}")

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏
                elif text == '/listusers':
                    role = get_user_role(user_id)
                    if role not in ['admin', 'super_admin']:
                        send_message("‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!")
                        continue

                    if not user_rights:
                        message = "üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏ –ø—É—Å—Ç."
                    else:
                        message = "üìã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø—Ä–∞–≤–∞–º–∏:\n\n"
                        for uid, rights in user_rights.items():
                            role_type = rights.get('role', 'user')
                            added_by = rights.get('added_by', '—Å–∏—Å—Ç–µ–º–∞')
                            added_date = rights.get('added_date', '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
                            is_super = rights.get('is_super', False)
                            super_mark = "üëë –°–£–ü–ï–†" if is_super else ""
                            admin_mark = "üëë" if role_type == 'admin' and not is_super else ""
                            editor_mark = "‚úèÔ∏è" if role_type == 'editor' else ""
                            
                            # –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å VK
                            vk_link = f"https://vk.com/id{uid}"
                            
                            message += f"{super_mark}{admin_mark}{editor_mark} ID: {uid}\n"
                            message += f" –°—Å—ã–ª–∫–∞: {vk_link}\n"
                            message += f" –†–æ–ª—å: {role_type}\n"
                            message += f" –î–æ–±–∞–≤–∏–ª: {added_by}\n"
                            message += f" –î–∞—Ç–∞: {added_date}\n\n"

                    send_message(message)

                # –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–æ–≤
                elif text == '/superadmins':
                    message = "üëë –°–£–ü–ï–†–ê–î–ú–ò–ù–´ (–Ω–µ–ª—å–∑—è –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞):\n\n"
                    for admin_id in SUPER_ADMINS:
                        vk_link = f"https://vk.com/id{admin_id}"
                        message += f"‚Ä¢ {admin_id} - {vk_link}\n"
                    send_message(message)

                # –ö–æ–º–∞–Ω–¥–∞ –ø–æ–º–æ—â–∏
                elif text == '/help':
                    help_text = ("üìã –°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ê–í–ê–ú–ò\n\n"
                                 "–î–ª—è –≤—Å–µ—Ö:\n"
                                 "‚Ä¢ /help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
                                 "‚Ä¢ /myrights - –º–æ–∏ –ø—Ä–∞–≤–∞\n"
                                 "‚Ä¢ /superadmins - —Å–ø–∏—Å–æ–∫ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω–æ–≤\n\n"
                                 "–î–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ (editor) –∏ –≤—ã—à–µ:\n"
                                 "‚Ä¢ /edit [—Å—Ç—Ä–æ–∫–∞/–Ω–∏–∫] [–ø–æ–ª–µ] [–∑–Ω–∞—á–µ–Ω–∏–µ] - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å\n"
                                 "‚Ä¢ /search [–∑–∞–ø—Ä–æ—Å] - –ø–æ–∏—Å–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n"
                                 "‚Ä¢ /stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
                                 "‚Ä¢ /addadmin [–Ω–∏–∫] [–¥–∞—Ç–∞] [V–ö] [—Ñ–æ—Ä—É–º] - –¥–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∞\n"
                                 "‚Ä¢ /lvlup [–ù–∏–∫] [lvl] [–î–∞—Ç–∞] - –ø–æ–≤—ã—Å–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å\n\n"
                                 "–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (admin) –∏ –≤—ã—à–µ:\n"
                                 "‚Ä¢ /unadmin [–Ω–∏–∫] - —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n"
                                 "‚Ä¢ /grant [V–ö_ID] [—Ä–æ–ª—å] - –≤—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞ (editor/admin)\n"
                                 "‚Ä¢ /revoke [V–ö_ID] - –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞\n"
                                 "‚Ä¢ /listusers - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏\n\n"
                                 "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
                                 "‚Ä¢ '+–Ω–≥' - –≤—Ä–µ–º—è –¥–æ –ù–æ–≤–æ–≥–æ –≥–æ–¥–∞\n"
                                 "‚Ä¢ '+–ª–µ—Ç–æ' - –≤—Ä–µ–º—è –¥–æ –ª–µ—Ç–∞\n\n"
                                 "–ö–æ–º–∞–Ω–¥–∞ /lvlup:\n"
                                 "‚Ä¢ lvl –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç 1 –¥–æ 5\n"
                                 "‚Ä¢ –î–∞—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì\n"
                                 "‚Ä¢ –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—Ç–∞–≤–∏—Ç —Å—Ç—Ä–æ–∫—É –≤—ã—à–µ —Å—Ç—Ä–æ–∫ —Å –º–µ–Ω—å—à–∏–º —É—Ä–æ–≤–Ω–µ–º\n"
                                 "‚Ä¢ –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Ü–≤–µ—Ç–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —à—Ä–∏—Ñ—Ç Comfortaa 11px (–∂–∏—Ä–Ω—ã–π)\n"
                                 "‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—ã –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö M –∏ N\n"
                                 "‚Ä¢ –î–æ—Å—Ç—É–ø–Ω–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º –∏ –≤—ã—à–µ\n\n"
                                 "–ü—Ä–∏–º–µ—Ä—ã:\n"
                                 "‚Ä¢ /addadmin Vasya 01.01.2024 https://vk.com/id1 https://forum.link\n"
                                 "‚Ä¢ /grant 123456789 editor\n"
                                 "‚Ä¢ /grant 987654321 admin\n"
                                 "‚Ä¢ /edit 5 Nick_Name –ù–æ–≤–æ–µ–ò–º—è\n"
                                 "‚Ä¢ /edit Vasya –î–∞—Ç–∞_–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è_1 15.02.2024\n"
                                 "‚Ä¢ /search Vasya\n"
                                 "‚Ä¢ /unadmin Vasya\n"
                                 "‚Ä¢ /lvlup Vasya 2 15.03.2024\n\n"
                                 f"üëë –°—É–ø–µ—Ä–∞–¥–º–∏–Ω—ã (–Ω–µ–ª—å–∑—è –æ—Ç–æ–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∞): {', '.join(map(str, SUPER_ADMINS))}")
                    send_message(help_text)

                elif text.startswith('/'):
                    send_message("‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –í–≤–µ–¥–∏—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.")

    except Exception as e:
        print(f"!!! –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: {e}")
        import traceback
        traceback.print_exc()
        time.sleep(5)

if __name__ == '__main__':
    main()
